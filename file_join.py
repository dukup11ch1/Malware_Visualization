import os
import pefile
import rich_analysis

def allfiles(path):
    res = []
    
    try :
        for _, _, files in os.walk(path):

            for file in files:
                filepath = os.path.join(path, file)
                res.append(filepath)
    except:
        pass
    return res

while True:
    filelist=allfiles('uploads')
    if filelist == []:
        continue
    else:
        for file_ in filelist:
            try:
                fp = open(file_,'rb')
                print(file_)
                pf=pefile.PE(file_)
                rich_info=rich_analysis.richheader(fp)
                #print(rich_info.info)
                os.remove(file_)
            except KeyboardInterrupt:
                exit()
            except ValueError:
                print(file_+' no have rich')
                os.remove(file_)
            except:
                print(file_+' is not pe')
                os.remove(file_)

                